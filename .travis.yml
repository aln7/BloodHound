language: node_js
node_js:
  - "6"

env:
  matrix:
    secure: E0DU2iabvh8t12ngHUnX/S3F0uwNu8lSBl6wc3xOHKcdZbj+teASvafPIss0q6VmM+IpSunvwSgGyVOJQMlgLHgF+4UeFeOipfGEPbgk1440urJXG7SjhJCxmtwv/Hew9G1fvye0/QBQBUkq1KL22irx8FEvUQBmSULGhurfJxLe79nI4TsvBwGROlV35uSq882xwHTwrQwS5yOS9fsGyrKW5gV9z/silObYBjzvi97hiDHUF/5sTlj0NMrEU7ypON3yuU0dHQKdZqHxyEuJjhMQvRgw2oiuXpzuyk02LhJ05/mydBopuZlKxZVakgaqUhetwcaHarWI/Ote19NI4MU+baHhcxTgP1rwO0w7ctMNYbzkGehijuYbWCcxZTXVNnMnPQ50grGxd9B3zY9Luy9p3pIfbMQplN1V29iyo7WIzEGr8uavFwKwT1OZKn7FuHTjpAIQULVxO5bbZO8QVS+0vvmHvsceruthvmxpfBRpWtvWm2Phj4f+oxdMkIUSNr5bpHTanrsrgfvNe4u65SGgRyBuukvpZJwwPBXWiMTsunfqiCTLgX+fKjyfv1pE2Vuq64UxHmenCichIRdExdajNEFdkfUtS7bGAwkHQSnFKc0i14YwoUr7mEIhgogCx0Ho0JUpDbw/efS1ExJPXyPEUCQlAM51RXHdvJGLZFM=

os:
  - linux
  - osx

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install p7zip; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -qq update; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y p7zip-full; fi

install:
  - npm install
  - npm install -g electron-packager

script:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then npm run macbuild; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then npm run linuxbuild; fi

before_deploy:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then 7z a -tzip -mx9 BloodHound-darwin-x64-$TRAVIS_COMMIT.zip BloodHound-darwin-x64 > /dev/null; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then 7z a -tzip -mx9 BloodHound-linux-ia32-$TRAVIS_COMMIT.zip BloodHound-linux-ia32 > /dev/null; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then 7z a -tzip -mx9 BloodHound-linux-x64-$TRAVIS_COMMIT.zip BloodHound-linux-x64 > /dev/null; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then 7z a -tzip -mx9 BloodHound-linux-armv7l-$TRAVIS_COMMIT.zip BloodHound-linux-armv7l > /dev/null; fi

deploy:
  provider: script
  script: /bin/bash deploy.sh
  skip_cleanup: true
  on:
    branch: master

notifications:
  email: false

branches:
  only:
    - master
