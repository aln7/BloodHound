language: node_js
node_js:
  - "6"

env:
  matrix:
    secure: UgCQtlr7FHjrija1B0AzPXzWeIDm+7VX8/Q0Ow9wHMe5LrAk5nXNdSLZXNxQLpTy2hJWI7D9RnW3fkF3v9KiejEGFHuQTkyRo0nuVvKAirlnsl2mn4M0ePS8yPwSrRqiWS2ZPnNkPLWT8EFv5Lx0k6KdG4qUlDZo/rzZLJrIfo7YhC5zlQRgkLonJUfWUOqhZ8LwGVMfUT1KzZ0HDK/ui/4uNYZHQKJD8afTbldy4TrdYIaOiQR+VrvX2bYIn7KG1kw1+BkcaMwETFRdIl/S6e42q4tqjdQKQeh+dZ2SNuXEzAKqm3BV9iPWoYjHEABy5cIOfz/WWUHzGcQJpHPrdLSs/dDwCTOPASWcPJIaNMK+8TO5h5NwP6nm112gpbJkMGJ/ACPUClk38gnx+nRlMwEXryrLEe1oqiYWq4XWd51CpgxbL2Y3hQ8Oo7fqO7XCU1ibpcNiD8Pij/HCqFAH1umfag3ctJwCHkC44fWgr3S8zQjl5qpTENDG2FgP/6rigYmazNumlzdr7i5gM1gOfLL9lFxA8YMvQ0SxsCwzQHcQn+Pxs5jF4hnnCGMNCUs3fNdkB8y7lmR7HD4ukRkpsvP7mGslhDlGVISa7vXADlXwE01UCdP4N6umOlXAqAWkHbg7r4F2tbFpHlnSmKlDtMXovmQ9IUycrluYf7zu2x8=

os:
  - linux
  - osx

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install p7zip; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -qq update; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y p7zip-full; fi

install:
  - npm install
  - npm install -g electron-packager

script:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then npm run macbuild; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then npm run linuxbuild; fi

before_deploy:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then 7z a -tzip -mx9 BloodHound-darwin-x64-$TRAVIS_COMMIT.zip BloodHound-darwin-x64 > /dev/null; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then 7z a -tzip -mx9 BloodHound-linux-ia32-$TRAVIS_COMMIT.zip BloodHound-linux-ia32 > /dev/null; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then 7z a -tzip -mx9 BloodHound-linux-x64-$TRAVIS_COMMIT.zip BloodHound-linux-x64 > /dev/null; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then 7z a -tzip -mx9 BloodHound-linux-armv7l-$TRAVIS_COMMIT.zip BloodHound-linux-armv7l > /dev/null; fi

deploy:
  provider: script
  script: /bin/bash deploy.sh
  skip_cleanup: true
  on:
    branch: master

notifications:
  email: false

branches:
  only:
    - master
